### General steps of using sandbox
Sandbox as a module is a functionality provided by a frontend library called [thebe](https://thebelab.readthedocs.io/en/latest/index.html) and backend provider [binder hub](http://mybinder.org/). For low level development, there isn't much to consider on the configurations.  Just use the code examples to use the sandbox.

### Core procedure
Here are the steps that need to be done synchroniously.

- Step1: Waiting for the kernel to be ready
- Step2: Execute necessary code like ```import pandas as pd```, and inject data as ```df``` variable
- Step3: Run any code using the imported modules

### Code example

### Step1 and Step2
Before executing step2, you need to get dataset.filename from redux store using ```let dataset = useSelector(state=>state.dataset)```

And here I used a state to store the data json string by ```setDfJSON```, you can use ```useRef``` or any other methods to save the data. 

```setActivateStatus``` is to change the state text shown in the page, if you don't need to present the status, just remove that line.

```javascript
useEffect(()=>{
    //Step1
    thebelab.bootstrap();

    //Step2
    thebelab.on("status", async function (evt, data) {
        if(data.status === 'ready' && dataset.filename){
            let res = await fetchByJSON('current_data_json',{
                filename:dataset.filename
            })

            let g = await res.json()
            kernelRef.current = data.kernel
            data.kernel.requestExecute({code:initialCode(g.data)})
            setDfJSON(g.data) // to store the data json string in other places
            setActivateStatus('Ready') // to show the activate status in the page
        }
    })
},[])
```

#### Step3
Here is what happened when user click the "Run" button, first the preambling code are being executed again using the stored data json string. Then a button provided by thebe is clicked. (the button is generated by thebelab.bootstrap())
```javascript
const runCode = async (e)=>{
    let res = await kernelRef.current.requestExecute({code:initialCode(dfJSON)}).done
    document.querySelector('.thebelab-run-button').click()
}
```

Here is the html element where we put our code. We convert this element into a format that thebe can recognize every time the code changes. If you want to change the code being executed, use ```setCode``` method instead of directly change the innerHMTL of that element.

```javascript 
<div ref={codeParent}>{code}</div>
```

```javascript
let [code,setCode] = useState('')

useEffect(()=>{
    if(!code) return
    codeParent.current.innerHTML = ''
    let pre = document.createElement('pre')
    pre.setAttribute('data-executable','true')
    pre.setAttribute('data-language','python')
    codeParent.current.appendChild(pre)
    pre.innerHTML = code
    thebelab.bootstrap();
},[code])
```

### Tips
When using ```setCode``` method to set the code need to be executed, the format should be
```javascript
setCode`firstline
secondline$()
thirdline
`
```
This is called template string. Otherwise, there could be unwanted spaces or string encoding issues.
